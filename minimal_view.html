<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Self Portrait</title>
<style>
  body {
    background: white;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-family: sans-serif;
  }
  img {
    max-width: 95vw;
    max-height: 80vh;
    object-fit: contain;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1rem;
    border: none;
    background: black;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background: #333;
  }
</style>
</head>
<body>
  <img id="art" src="" alt="Artwork">
  <button id="saveBtn">ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°</button>

  <script>
  const params = new URLSearchParams(window.location.search);
  const imgUrl = params.get('img');
  const art = document.getElementById('art');
  const saveBtn = document.getElementById('saveBtn');

  // ğŸ”¹ ë¡œë”© ë¬¸êµ¬ ì»¨í…Œì´ë„ˆ
  const loadingText = document.createElement('div');
  loadingText.style.marginTop = "30px";
  loadingText.style.fontSize = "1.1rem";
  loadingText.style.color = "#444";
  loadingText.style.display = "flex";
  loadingText.style.flexDirection = "column";
  loadingText.style.alignItems = "center";
  loadingText.style.gap = "12px";

  // ğŸ”¹ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (íšŒì „ ì›)
  const spinner = document.createElement('div');
  spinner.style.border = "6px solid #f3f3f3";
  spinner.style.borderTop = "6px solid black";
  spinner.style.borderRadius = "50%";
  spinner.style.width = "40px";
  spinner.style.height = "40px";
  spinner.style.animation = "spin 1s linear infinite";

  const text = document.createElement('p');
  text.textContent = "ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)";

  loadingText.appendChild(spinner);
  loadingText.appendChild(text);
  document.body.insertBefore(loadingText, saveBtn);

  // ğŸ”¹ CSS ì• ë‹ˆë©”ì´ì…˜ ì •ì˜
  const style = document.createElement('style');
  style.innerHTML = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
  document.head.appendChild(style);

  // ğŸ”¹ ì´ë¯¸ì§€ ë¡œë”© ë¡œì§
  if (imgUrl) {
    setTimeout(() => {
      art.src = imgUrl + "?t=" + new Date().getTime(); // ìºì‹œ ë°©ì§€
      art.onload = () => {
        loadingText.style.display = "none"; // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ìˆ¨ê¹€
      };
    }, 20000); // 20ì´ˆ í›„ ë¡œë“œ
  } else {
    art.alt = "ì´ë¯¸ì§€ URLì´ ì—†ìŠµë‹ˆë‹¤.";
    saveBtn.style.display = "none";
    text.textContent = "ìœ íš¨í•œ ì´ë¯¸ì§€ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.";
  }

  saveBtn.addEventListener('click', () => {
    const link = document.createElement('a');
    link.href = art.src;
    link.download = 'selfportrait.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
</script>
</body>
</html>
